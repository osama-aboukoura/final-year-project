{% load staticfiles %}
<link rel="stylesheet" type="text/css" href="{% static 'style.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'post-comment-reply/style.css' %}" />
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css" integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns" crossorigin="anonymous">

{% include "main/navigationbar.html" %}

<div class='post-topic'>
    <h3 style='word-break: break-all'><a href="{% url 'main:topic' postTopicNoSpaces %}">{{post.postTopic}}{% if post.postAutoClassification == True %} - (Automatically Classified){% endif %}</a></h3>
    {% if post.postTopicRelatedWords %}
        <p style='margin-bottom:0; padding: 0px 10px; color:gray;'>Words that appear frequently in this topic according to our dataset:</p>
        <h4 style='margin-top:0; padding: 0px 10px; color:gray;'>{{post.postTopicRelatedWords}}</h4>
    {% endif %}
</div>
{% if post.postDisabled %}
    <div class='post-disabled-message'>This post is currently disabled and is not accessible to basic-type users. Only Staff members can view it.</div>
{% endif %}

<div class='wrapper'>

    <div class='post-title'>
        {% if user.is_authenticated %}
            {% if user.username == post.postedBy.user.username and post.postClosed == True %}
                <a class='button green repoen-comments-button' href="{% url 'post:open-comments' post.pk %}">Re-open Post Comments</a>
            {% endif %}
        {% endif %}
        <h1 style='width: 75%; word-break: break-all'>{{post.postTitle}}</h1>
        {% if post.postClosed %}
            <h2 style='color:#CB4335;'>[CLOSED. Author has accepted one of the answers]</h2>
        {% endif %}
        <p class='discussion-postedBy-and-date'>Discussion started by: <a class='discussion-started-by' href="{% url 'main:profile' post.postedBy.user %}" >{{post.postedBy.user.first_name}} {{post.postedBy.user.last_name}}</a> on {{post.postDate}}{% if post.postLastUpdated > post.postDate %} - latest update on {{post.postLastUpdated}}{% endif %}</p>
    </div>
    <hr />

    {% include "post/post.html" %}
    
    {% if post.comment_set.all %}
        {% comment %} show the accepted comment first {% endcomment %}
        {% for comment in post.comment_set.all %}
            {% if comment.commentAccepted and not comment.commentDisabled %} 
                {% include "comment/comment.html" %}
                {% for reply in comment.reply_set.all %}
                    {% if not reply.replyDisabled %}
                        {% include "reply/reply.html" %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endfor %}
        
        {% comment %} show all the other comments {% endcomment %}
        {% for comment in post.comment_set.all %}
            {% if not comment.commentAccepted and not comment.commentDisabled %}
                {% include "comment/comment.html" %}
                {% for reply in comment.reply_set.all %}
                    {% if not reply.replyDisabled %}
                        {% include "reply/reply.html" %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endfor %}
    {% else %}
        <div style='padding: 10px 3%; width:94%; border:1px solid gray;'>
            <p>No Comments yet.</p>
        </div>
    {% endif %}
    
</div>